{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Ignition Perspective Core Components Schema",
  "description": "JSON Schema validation rules for core Ignition Perspective ia.* components extracted from representative perspective assets",
  "type": "object",
  "definitions": {
    "componentBase": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "pattern": "^ia\\."
        },
        "meta": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "tooltip": {
              "type": "object",
              "properties": {
                "enabled": { "type": "boolean" },
                "location": { "type": "string" },
                "sustain": { "type": "number" },
                "text": { "type": "string" },
                "delay": { "type": "number" },
                "tail": { "type": "boolean" }
              },
              "additionalProperties": true
            }
          },
          "additionalProperties": true
        },
        "position": {
          "type": "object",
          "properties": {
            "x": { "type": "number" },
            "y": { "type": "number" },
            "width": { "type": "number" },
            "height": { "type": "number" },
            "basis": { "type": ["string", "number"] },
            "grow": { "type": "number", "minimum": 0 },
            "shrink": { "type": "number", "minimum": 0 },
            "display": { "type": "boolean" },
            "marginLeft": { "type": "string" },
            "marginRight": { "type": "string" },
            "marginTop": { "type": "string" },
            "marginBottom": { "type": "string" }
          },
          "additionalProperties": true
        },
        "props": {
          "type": "object",
          "properties": {
            "style": {
              "type": "object",
              "properties": {
                "classes": { "type": "string" },
                "margin": { "type": "number" },
                "padding": { "type": "number" },
                "width": { "type": "string" },
                "height": { "type": "string" },
                "overflow": { "type": "string" },
                "user-select": { "type": "string" },
                "alignSelf": { "type": "string" },
                "backgroundColor": { "type": "string" },
                "color": { "type": "string" },
                "textAlign": { "type": "string" },
                "marginLeft": { "type": ["number", "string"] },
                "marginRight": { "type": ["number", "string"] },
                "marginTop": { "type": ["number", "string"] },
                "marginBottom": { "type": ["number", "string"] }
              },
              "additionalProperties": true
            },
            "textStyle": {
              "type": "object",
              "properties": {
                "classes": { "type": "string" },
                "margin": { "type": "number" },
                "fontWeight": { "type": ["string", "number"] },
                "fontSize": { "type": "string" },
                "color": { "type": "string" },
                "textAlign": { "type": "string" }
              },
              "additionalProperties": true
            }
          },
          "additionalProperties": true
        },
        "propConfig": {
          "type": "object",
          "patternProperties": {
            ".*": {
              "type": "object",
              "properties": {
                "binding": {
                  "type": "object",
                  "properties": {
                    "type": { "type": "string", "enum": ["property", "expr", "tag"] },
                    "config": { "type": "object" },
                    "transforms": { "type": "array" }
                  },
                  "additionalProperties": true
                },
                "paramDirection": { "type": "string", "enum": ["input", "output", "inout"] },
                "persistent": { "type": "boolean" }
              },
              "additionalProperties": true
            }
          }
        },
        "events": {
          "type": "object",
          "properties": {
            "component": { 
              "type": "object",
              "additionalProperties": true
            },
            "dom": { 
              "type": "object",
              "additionalProperties": true
            }
          },
          "additionalProperties": true
        },
        "custom": {
          "type": "object",
          "additionalProperties": true
        },
        "children": {
          "type": "array",
          "items": { "$ref": "#/definitions/componentBase" }
        }
      },
      "additionalProperties": false
    },
    "containerComponents": {
      "allOf": [
        { "$ref": "#/definitions/componentBase" },
        {
          "properties": {
            "type": {
              "enum": [
                "ia.container.flex",
                "ia.container.coord", 
                "ia.container.breakpt",
                "ia.container.tab"
              ]
            },
            "props": {
              "type": "object",
              "properties": {
                "direction": { "type": "string", "enum": ["row", "column"] },
                "justify": { "type": "string" },
                "alignItems": { "type": "string" },
                "wrap": { "type": "string" },
                "gap": { "type": "number" },
                "align": { "type": "string" }
              },
              "additionalProperties": true
            }
          }
        }
      ]
    },
    "displayComponents": {
      "allOf": [
        { "$ref": "#/definitions/componentBase" },
        {
          "properties": {
            "type": {
              "enum": [
                "ia.display.label",
                "ia.display.icon", 
                "ia.display.view",
                "ia.display.table",
                "ia.display.flex-repeater",
                "ia.display.markdown",
                "ia.display.tree",
                "ia.display.image",
                "ia.display.iframe",
                "ia.display.tag-browse-tree",
                "ia.display.viewcanvas",
                "ia.display.progress",
                "ia.display.equipmentschedule",
                "ia.display.barcode",
                "ia.display.alarmstatustable",
                "ia.display.alarmjournaltable"
              ]
            }
          }
        }
      ]
    },
    "labelComponent": {
      "allOf": [
        { "$ref": "#/definitions/displayComponents" },
        {
          "properties": {
            "type": { "const": "ia.display.label" },
            "props": {
              "type": "object",
              "properties": {
                "text": { "type": "string" },
                "alignVertical": { "type": "string" },
                "alignHorizontal": { "type": "string" },
                "textStyle": {
                  "type": "object",
                  "properties": {
                    "classes": { "type": "string" },
                    "margin": { "type": "number" },
                    "fontWeight": { "type": ["string", "number"] },
                    "fontSize": { "type": "string" },
                    "color": { "type": "string" },
                    "textAlign": { "type": "string" }
                  },
                  "additionalProperties": true
                }
              },
              "additionalProperties": true
            }
          }
        }
      ]
    },
    "iconComponent": {
      "allOf": [
        { "$ref": "#/definitions/displayComponents" },
        {
          "properties": {
            "type": { "const": "ia.display.icon" },
            "props": {
              "type": "object",
              "properties": {
                "path": { "type": "string" },
                "color": { "type": "string" },
                "rotation": { "type": "number" },
                "size": { "type": "number" }
              }
            }
          }
        }
      ]
    },
    "inputComponents": {
      "allOf": [
        { "$ref": "#/definitions/componentBase" },
        {
          "properties": {
            "type": {
              "enum": [
                "ia.input.button",
                "ia.input.dropdown",
                "ia.input.text-field",
                "ia.input.numeric-entry-field",
                "ia.input.checkbox",
                "ia.input.text-area",
                "ia.input.oneshotbutton",
                "ia.input.date-time-input",
                "ia.input.multi-state-button",
                "ia.input.toggle-switch",
                "ia.input.signature-pad",
                "ia.input.fileupload"
              ]
            }
          }
        }
      ]
    },
    "buttonComponent": {
      "allOf": [
        { "$ref": "#/definitions/inputComponents" },
        {
          "properties": {
            "type": { "enum": ["ia.input.button", "ia.input.oneshotbutton"] },
            "props": {
              "type": "object",
              "properties": {
                "text": { "type": "string" },
                "enabled": { "type": "boolean" },
                "visible": { "type": "boolean" },
                "icon": { "type": "object" },
                "image": { "type": "object" },
                "value": { "type": ["boolean", "number", "string"] },
                "textStyle": {
                  "type": "object",
                  "properties": {
                    "classes": { "type": "string" },
                    "margin": { "type": "number" }
                  },
                  "additionalProperties": true
                }
              },
              "additionalProperties": true
            }
          }
        }
      ]
    },
    "chartComponents": {
      "allOf": [
        { "$ref": "#/definitions/componentBase" },
        {
          "properties": {
            "type": {
              "enum": ["ia.chart.pie", "ia.chart.xy"]
            }
          }
        }
      ]
    },
    "xyChartComponent": {
      "allOf": [
        { "$ref": "#/definitions/chartComponents" },
        {
          "properties": {
            "type": { "const": "ia.chart.xy" },
            "props": {
              "type": "object",
              "properties": {
                "dataSources": { "type": "object" },
                "series": { "type": "array" },
                "xAxes": { "type": "array" },
                "yAxes": { "type": "array" }
              }
            }
          }
        }
      ]
    },
    "navigationComponents": {
      "allOf": [
        { "$ref": "#/definitions/componentBase" },
        {
          "properties": {
            "type": {
              "enum": ["ia.navigation.menutree", "ia.navigation.horizontalmenu"]
            }
          }
        }
      ]
    }
  },
  "oneOf": [
    { "$ref": "#/definitions/containerComponents" },
    { "$ref": "#/definitions/labelComponent" },
    { "$ref": "#/definitions/iconComponent" },
    { "$ref": "#/definitions/buttonComponent" },
    { "$ref": "#/definitions/xyChartComponent" },
    { "$ref": "#/definitions/displayComponents" },
    { "$ref": "#/definitions/inputComponents" },
    { "$ref": "#/definitions/chartComponents" },
    { "$ref": "#/definitions/navigationComponents" }
  ]
}