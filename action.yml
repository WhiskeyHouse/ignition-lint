name: 'Ignition Lint'
description: 'Comprehensive linting toolkit for Ignition SCADA projects. Validates Perspective views, scripts, naming conventions, expressions, and code quality.'
author: 'Patrick Mannion'

inputs:
  version:
    description: 'Version of ignition-lint to install (default: latest)'
    required: false
    default: ''
  files:
    description: 'Comma-separated list of ignition files to lint (supports glob patterns)'
    required: false
    default: '**/view.json'
  component_style:
    description: 'Naming convention style for components'
    required: false
    default: 'PascalCase'
  parameter_style:
    description: 'Naming convention style for parameters'
    required: false
    default: 'camelCase'
  component_style_rgx:
    description: 'Custom regex pattern for component naming'
    required: false
  parameter_style_rgx:
    description: 'Custom regex pattern for parameter naming'
    required: false
  allow_acronyms:
    description: 'Allow acronyms in component and parameter names'
    required: false
    default: 'false'
  project_path:
    description: 'Path to Ignition project directory (alternative to files)'
    required: false
  lint_type:
    description: 'Type of linting to perform (perspective, scripts, all)'
    required: false
    default: 'perspective'
  naming_only:
    description: 'Only run naming convention checks, skip empirical linter'
    required: false
    default: 'true'
  ignore_codes:
    description: 'Comma-separated rule codes to suppress globally'
    required: false
    default: ''
  schema_mode:
    description: 'Schema strictness level (strict, robust, permissive)'
    required: false
    default: 'robust'
  fail_on:
    description: 'Minimum severity that causes a non-zero exit (error, warning, info, style)'
    required: false
    default: 'error'
  component:
    description: 'Filter Perspective linting to a specific component type prefix (e.g. ia.display.label)'
    required: false

outputs:
  result:
    description: 'Linting result (success or failure)'

branding:
  icon: 'zap'
  color: 'orange'

runs:
  using: 'composite'
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install ignition-lint-toolkit
      shell: bash
      run: |
        python -m pip install --upgrade pip
        if [ -n "${{ inputs.version }}" ]; then
          pip install "ignition-lint-toolkit==${{ inputs.version }}"
        else
          pip install ignition-lint-toolkit
        fi

    - name: Run Ignition Lint
      shell: bash
      env:
        INPUT_FILES: ${{ inputs.files }}
        INPUT_COMPONENT_STYLE: ${{ inputs.component_style }}
        INPUT_PARAMETER_STYLE: ${{ inputs.parameter_style }}
        INPUT_COMPONENT_STYLE_RGX: ${{ inputs.component_style_rgx }}
        INPUT_PARAMETER_STYLE_RGX: ${{ inputs.parameter_style_rgx }}
        INPUT_ALLOW_ACRONYMS: ${{ inputs.allow_acronyms }}
        INPUT_PROJECT_PATH: ${{ inputs.project_path }}
        INPUT_LINT_TYPE: ${{ inputs.lint_type }}
        INPUT_NAMING_ONLY: ${{ inputs.naming_only }}
        INPUT_IGNORE_CODES: ${{ inputs.ignore_codes }}
        INPUT_SCHEMA_MODE: ${{ inputs.schema_mode }}
        INPUT_FAIL_ON: ${{ inputs.fail_on }}
        INPUT_COMPONENT: ${{ inputs.component }}
      run: ignition-lint-action
