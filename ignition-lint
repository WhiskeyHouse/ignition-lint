#!/usr/bin/env python3
"""
CLI wrapper for Ignition Perspective Linter
Designed for easy integration with agentic development workflows
"""

import argparse
import json
import sys
from pathlib import Path
import sys
import os
sys.path.append(os.path.dirname(os.path.abspath(__file__)))
from ignition_perspective_linter import IgnitionPerspectiveLinter

def main():
    parser = argparse.ArgumentParser(
        description="Lint Ignition Perspective components for agentic development"
    )
    parser.add_argument("path", help="Path to view file or directory")
    parser.add_argument("--format", choices=["json", "text"], default="json", 
                       help="Output format (default: json for agents)")
    parser.add_argument("--severity", choices=["error", "warning", "info", "style"], 
                       default="warning", help="Minimum severity level")
    parser.add_argument("--component-type", help="Filter by specific component type")
    parser.add_argument("--exit-code", action="store_true", 
                       help="Exit with non-zero code on issues")
    
    args = parser.parse_args()
    
    # Initialize linter
    linter = IgnitionPerspectiveLinter()
    
    # Run linting
    if Path(args.path).is_file():
        results = linter.lint_file(args.path)
        total_issues = sum(len(issues) for issues in results["issues"].values())
    else:
        results = linter.lint_project(args.path, args.component_type)
        total_issues = results["summary"]["total_issues"]
    
    # Filter by severity
    severity_levels = {"error": 0, "warning": 1, "info": 2, "style": 3}
    min_level = severity_levels[args.severity]
    
    if args.format == "json":
        # Agent-friendly JSON output
        output = {
            "status": "success" if total_issues == 0 else "issues_found",
            "summary": results.get("summary", {}),
            "issues": results["issues"],
            "schema_compliance": results.get("schema_compliance", {}),
            "recommendations": results.get("recommendations", [])
        }
        print(json.dumps(output, indent=2))
    else:
        # Human-readable text output
        if total_issues == 0:
            print("âœ… No issues found")
        else:
            print(f"âŒ Found {total_issues} issues")
            for file_path, issues in results["issues"].items():
                if issues:
                    print(f"\nðŸ“ {file_path}")
                    for issue in issues:
                        print(f"  {issue['severity'].upper()}: {issue['message']}")
    
    # Exit code for CI/CD
    if args.exit_code and total_issues > 0:
        sys.exit(1)

if __name__ == "__main__":
    main()